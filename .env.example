# Square Dashboard Addon Tool - Environment Configuration
# Copy this file to .env and fill in your actual values

# Square API Configuration
SQUARE_ACCESS_TOKEN=your_square_access_token_here
# Get your access token from: https://developer.squareup.com/apps

# Square Web Payments SDK Configuration (for subscriptions)
SQUARE_APPLICATION_ID=your_square_application_id_here
SQUARE_LOCATION_ID=your_square_location_id_here
SQUARE_ENVIRONMENT=sandbox
# Set SQUARE_ENVIRONMENT to 'production' for live payments
# Get these from: https://developer.squareup.com/apps > Your App > Credentials

# Square OAuth Configuration (Multi-Tenant / App Marketplace)
# For multi-tenant mode, each merchant connects their own Square account via OAuth
# SQUARE_APPLICATION_SECRET is required for OAuth token exchange
SQUARE_APPLICATION_SECRET=your_square_application_secret_here
# Get this from: https://developer.squareup.com/apps > Your App > OAuth

# OAuth Redirect URI - Must match exactly in Square Developer Dashboard
# This is where Square redirects after merchant authorizes the app
SQUARE_OAUTH_REDIRECT_URI=https://yourdomain.com/api/square/oauth/callback
# For local development: http://localhost:5001/api/square/oauth/callback

# Token Encryption Key - REQUIRED for multi-tenant mode
# Used to encrypt Square OAuth tokens at rest in the database
# Generate with: openssl rand -hex 32
# IMPORTANT: Store this securely and NEVER commit to git
TOKEN_ENCRYPTION_KEY=your_32_byte_hex_key_here

# Square Webhook Configuration
# Webhook URL: https://yourdomain.com/api/webhooks/square
# Subscribe to these events in Square Developer Dashboard:
#   - catalog.version.updated (product/price changes)
#   - inventory.count.updated (stock level changes)
#   - order.created (new orders)
#   - order.updated (order modifications)
#   - order.fulfillment.updated (fulfillment status)
#   - oauth.authorization.revoked (app disconnected)
SQUARE_WEBHOOK_SIGNATURE_KEY=your_webhook_signature_key_here
# Get this from: https://developer.squareup.com/apps > Your App > Webhooks

# Webhook Feature Flags (real-time sync from Square)
# Enable these for instant updates instead of waiting for cron sync
# Set to 'false' to disable specific webhook handlers
WEBHOOK_CATALOG_SYNC=true         # Sync catalog when items change in Square
WEBHOOK_INVENTORY_SYNC=true       # Sync inventory when counts change
WEBHOOK_ORDER_SYNC=true           # Sync committed inventory & sales when orders change

# Subscription Enforcement
SUBSCRIPTION_CHECK_ENABLED=false
# Set to 'true' to enforce subscription validation on protected routes
# When enabled, users must have an active subscription to access the dashboard

# Database Configuration
DB_USER=postgres
DB_HOST=localhost
DB_NAME=square_dashboard_addon
DB_PASSWORD=your_database_password_here
DB_PORT=5432

# Server Configuration
PORT=5001
NODE_ENV=development

# ==================== AUTHENTICATION & SECURITY ====================

# Session Configuration
# REQUIRED for production - generate a random 32+ character string
# Example: openssl rand -base64 32
SESSION_SECRET=change-this-to-a-random-secret-in-production
SESSION_DURATION_HOURS=24    # How long users stay logged in (1-720 hours)

# Authentication
# Set AUTH_DISABLED=true to bypass authentication (development only!)
# WARNING: Never disable auth in production
AUTH_DISABLED=false

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000        # Rate limit window (15 minutes = 900000ms)
RATE_LIMIT_MAX_REQUESTS=100        # Max requests per window
LOGIN_RATE_LIMIT_MAX=5             # Max login attempts per 15 minutes

# CORS Configuration
# Comma-separated list of allowed origins (leave empty to allow all in development)
# For production, set to your domain(s):
# ALLOWED_ORIGINS=https://yourdomain.com, https://admin.yourdomain.com
ALLOWED_ORIGINS=

# Security Headers
# Set to 'true' to disable helmet security headers (not recommended)
DISABLE_SECURITY_HEADERS=false

# ==================================================================

# PUBLIC_APP_URL - Where browsers should redirect after OAuth
# This is DIFFERENT from GOOGLE_REDIRECT_URI!
# - GOOGLE_REDIRECT_URI: OAuth callback URL registered with Google (can be localhost)
# - PUBLIC_APP_URL: Where users' browsers end up after OAuth (must be reachable by user)
#
# For Raspberry Pi LAN access:
#   PUBLIC_APP_URL=http://192.168.0.64:5001  (your Pi's LAN IP)
#   GOOGLE_REDIRECT_URI=http://localhost:5001/api/google/callback  (Google accepts localhost)
#
# For production with a domain:
#   PUBLIC_APP_URL=https://yourdomain.com
#   GOOGLE_REDIRECT_URI=https://yourdomain.com/api/google/callback
#
# Leave empty to auto-detect from request (works if accessed directly, not via OAuth)
PUBLIC_APP_URL=

# Inventory Business Rules
REORDER_SAFETY_DAYS=7
DEFAULT_SUPPLY_DAYS=45

# Reorder Priority Thresholds (in days)
REORDER_PRIORITY_URGENT_DAYS=0        # Out of stock
REORDER_PRIORITY_HIGH_DAYS=7          # Less than 7 days
REORDER_PRIORITY_MEDIUM_DAYS=14       # Less than 14 days
REORDER_PRIORITY_LOW_DAYS=30          # Less than 30 days
# Note: inventory_alert_threshold from Square takes priority over days calculation

# Sync Intervals (in hours)
# Configure how often each type of sync should run
SYNC_CATALOG_INTERVAL_HOURS=3
SYNC_LOCATIONS_INTERVAL_HOURS=3
SYNC_SALES_91D_INTERVAL_HOURS=3
SYNC_SALES_182D_INTERVAL_HOURS=24
SYNC_SALES_365D_INTERVAL_HOURS=168
SYNC_INVENTORY_INTERVAL_HOURS=3
SYNC_VENDORS_INTERVAL_HOURS=24

# Automated Sync Cron Schedule
# Default: '0 * * * *' (every hour at minute 0)
# Format: minute hour day-of-month month day-of-week
# Examples:
#   '0 * * * *'     = Every hour
#   '*/30 * * * *'  = Every 30 minutes
#   '0 */2 * * *'   = Every 2 hours
#   '0 0 * * *'     = Daily at midnight
SYNC_CRON_SCHEDULE=0 * * * *

# Automated Database Backup Cron Schedule
# Default: '0 2 * * 0' (every Sunday at 2:00 AM)
# Format: minute hour day-of-month month day-of-week
# Examples:
#   '0 2 * * 0'     = Every Sunday at 2:00 AM
#   '0 3 * * 1'     = Every Monday at 3:00 AM
#   '0 2 1 * *'     = First day of month at 2:00 AM
#   '0 2 */7 * *'   = Every 7 days at 2:00 AM
# Note: Requires EMAIL_ENABLED=true to receive backups via email
BACKUP_CRON_SCHEDULE=0 2 * * 0

# Logging Configuration
LOG_LEVEL=info                    # debug, info, warn, error
LOG_MAX_SIZE=20m                  # Max size before rotation (20MB)
LOG_MAX_FILES=14d                 # Keep logs for 14 days
LOG_ERROR_MAX_FILES=30d           # Keep error logs for 30 days

# Email Notifications
EMAIL_ENABLED=false               # Set to 'true' to enable email alerts
EMAIL_SERVICE=gmail               # gmail, outlook, or custom SMTP
EMAIL_USER=your-email@gmail.com   # Your email address
EMAIL_PASSWORD=your-app-password  # Gmail app password (not regular password)
EMAIL_TO=alerts@yourdomain.com    # Where to send alerts
EMAIL_FROM=noreply@yourdomain.com # From address (optional)

# Email Throttling
EMAIL_THROTTLE_MINUTES=5          # Minimum minutes between error emails

# AWS S3 Configuration (for product images)
AWS_S3_BUCKET=items-images-production
AWS_S3_REGION=us-west-2

# Cycle Count Configuration
DAILY_COUNT_TARGET=30                 # Target number of items to count per day
CYCLE_COUNT_EMAIL_ENABLED=true        # Send daily count assignment emails
CYCLE_COUNT_REPORT_EMAIL=true         # Send completion report emails
ADDITIONAL_CYCLE_COUNT_REPORT_EMAIL=  # Optional: Additional email for cycle count reports (e.g., staff@yourdomain.com)

# Google OAuth Configuration (for Google Sheets integration)
GOOGLE_CLIENT_ID=your_google_client_id_here
GOOGLE_CLIENT_SECRET=your_google_client_secret_here
# Get these from: https://console.cloud.google.com/apis/credentials

# GOOGLE_REDIRECT_URI - REQUIRED for Google OAuth
# This MUST exactly match one of the "Authorized redirect URIs" in Google Cloud Console
# IMPORTANT: Never use a private IP address (192.168.x.x, 10.x.x.x, 172.16-31.x.x)
# For local development:
GOOGLE_REDIRECT_URI=http://localhost:5001/api/google/callback
# For production, use your public domain:
# GOOGLE_REDIRECT_URI=https://yourdomain.com/api/google/callback
