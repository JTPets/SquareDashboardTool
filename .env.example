# Square Dashboard Addon Tool - Environment Configuration
# Copy this file to .env and fill in your actual values
#
# IMPORTANT: Do NOT use inline comments!
#   WRONG: DB_PORT=5432 # database port
#   RIGHT: # database port
#          DB_PORT=5432
#   Inline comments cause "command not found" errors when sourcing .env

# ==================== SQUARE API CONFIGURATION ====================

# Get your access token from: https://developer.squareup.com/apps
SQUARE_ACCESS_TOKEN=your_square_access_token_here

# Square Web Payments SDK Configuration (for subscriptions)
# Get these from: https://developer.squareup.com/apps > Your App > Credentials
SQUARE_APPLICATION_ID=your_square_application_id_here
SQUARE_LOCATION_ID=your_square_location_id_here

# Set to 'production' for live payments
SQUARE_ENVIRONMENT=sandbox

# ==================== SQUARE OAUTH (MULTI-TENANT) ====================

# For multi-tenant mode, each merchant connects their own Square account via OAuth
# SQUARE_APPLICATION_SECRET is required for OAuth token exchange
# Get this from: https://developer.squareup.com/apps > Your App > OAuth
SQUARE_APPLICATION_SECRET=your_square_application_secret_here

# OAuth Redirect URI - Must match exactly in Square Developer Dashboard
# This is where Square redirects after merchant authorizes the app
# For local development: http://localhost:5001/api/square/oauth/callback
SQUARE_OAUTH_REDIRECT_URI=https://yourdomain.com/api/square/oauth/callback

# Token Encryption Key - REQUIRED for multi-tenant mode
# Used to encrypt Square OAuth tokens at rest in the database
# Generate with: openssl rand -hex 32
# IMPORTANT: Store this securely and NEVER commit to git
TOKEN_ENCRYPTION_KEY=your_32_byte_hex_key_here

# ==================== SQUARE WEBHOOKS ====================

# Webhook URL: https://yourdomain.com/api/webhooks/square
#
# You can register webhooks programmatically via POST /api/webhooks/register
# or manually in Square Developer Dashboard.
#
# RECOMMENDED WEBHOOK EVENTS (15 total):
#
# ESSENTIAL - Core Features:
#   - order.created              New orders, delivery ingestion, loyalty tracking
#   - order.updated              Order changes, delivery updates, loyalty tracking
#   - order.fulfillment.updated  Delivery status sync, sales velocity
#   - catalog.version.updated    Catalog sync (items, prices, variations, deletions)
#   - inventory.count.updated    Real-time inventory updates
#   - oauth.authorization.revoked Security - app disconnection handling
#
# LOYALTY - Frequent Buyer Program:
#   - loyalty.event.created      Catches orders linked via loyalty card scan
#   - payment.created            Payment tracking (for early loyalty processing)
#   - payment.updated            Payment completion triggers loyalty processing
#
# REFUNDS - Loyalty Adjustments:
#   - refund.created             Refund processing for loyalty point adjustments
#   - refund.updated             Refund status changes
#
# VENDORS - Vendor Management:
#   - vendor.created             New vendors added
#   - vendor.updated             Vendor name/status/contact changes
#
# LOCATIONS - Location Sync:
#   - location.created           New locations added
#   - location.updated           Location name/status/address changes
#
# OPTIONAL WEBHOOK EVENTS:
#
# SUBSCRIPTIONS (if using paid subscription features):
#   - subscription.created       New subscription created
#   - subscription.updated       Subscription status changes
#   - invoice.payment_made       Successful subscription payment
#   - invoice.payment_failed     Failed subscription payment
#   - customer.deleted           Customer removed from Square
#
# CUSTOMERS:
#   - customer.updated           Customer note changes (for delivery orders)

# Get this from: https://developer.squareup.com/apps > Your App > Webhooks
SQUARE_WEBHOOK_SIGNATURE_KEY=your_webhook_signature_key_here

# Optional: Override webhook URL (auto-detected from host if not set)
SQUARE_WEBHOOK_URL=

# Webhook Feature Flags (real-time sync from Square)
# Enable these for instant updates instead of waiting for cron sync
# Set to 'false' to disable specific webhook handlers

# Sync catalog when items change in Square
WEBHOOK_CATALOG_SYNC=true

# Sync inventory when counts change
WEBHOOK_INVENTORY_SYNC=true

# Sync committed inventory & sales when orders change
WEBHOOK_ORDER_SYNC=true

# ==================== SUBSCRIPTION ENFORCEMENT ====================

# Set to 'true' to enforce subscription validation on protected routes
# When enabled, users must have an active subscription to access the dashboard
SUBSCRIPTION_CHECK_ENABLED=false

# ==================== DATABASE CONFIGURATION ====================

DB_USER=postgres
DB_HOST=localhost
DB_NAME=square_dashboard_addon
DB_PASSWORD=your_database_password_here
DB_PORT=5432

# ==================== SERVER CONFIGURATION ====================

PORT=5001
NODE_ENV=development

# ==================== AUTHENTICATION & SECURITY ====================

# Session Configuration
# REQUIRED for production - generate a random 32+ character string
# Example: openssl rand -base64 32
SESSION_SECRET=change-this-to-a-random-secret-in-production

# How long users stay logged in (1-720 hours)
SESSION_DURATION_HOURS=24

# Super Admin Access
# Comma-separated list of email addresses with super-admin privileges
# Super admins can access all merchants and admin-only features
SUPER_ADMIN_EMAILS=admin@yourdomain.com

# Rate Limiting
# Rate limit window (15 minutes = 900000ms)
RATE_LIMIT_WINDOW_MS=900000

# Max requests per window
RATE_LIMIT_MAX_REQUESTS=100

# Max login attempts per 15 minutes
LOGIN_RATE_LIMIT_MAX=5

# CORS Configuration
# Comma-separated list of allowed origins (leave empty to allow all in development)
# For production, set to your domain(s)
# IMPORTANT: Do NOT use quotes around the value!
# Good: ALLOWED_ORIGINS=https://yourdomain.com,https://admin.yourdomain.com
# Bad:  ALLOWED_ORIGINS="https://yourdomain.com,https://admin.yourdomain.com"
ALLOWED_ORIGINS=

# Force HTTPS upgrade (only enable if you have HTTPS configured)
# Set to 'true' to add CSP upgradeInsecureRequests directive
# WARNING: Enabling this without HTTPS will break your app!
FORCE_HTTPS=false

# Security Headers
# Set to 'true' to disable helmet security headers (not recommended)
DISABLE_SECURITY_HEADERS=false

# ==================== PUBLIC APP URL ====================

# PUBLIC_APP_URL - Where browsers should redirect after OAuth
# This is DIFFERENT from GOOGLE_REDIRECT_URI!
# - GOOGLE_REDIRECT_URI: OAuth callback URL registered with Google (can be localhost)
# - PUBLIC_APP_URL: Where users' browsers end up after OAuth (must be reachable by user)
#
# For Raspberry Pi LAN access:
#   PUBLIC_APP_URL=http://192.168.0.64:5001  (your Pi's LAN IP)
#   GOOGLE_REDIRECT_URI=http://localhost:5001/api/google/callback  (Google accepts localhost)
#
# For production with a domain:
#   PUBLIC_APP_URL=https://yourdomain.com
#   GOOGLE_REDIRECT_URI=https://yourdomain.com/api/google/callback
#
# Leave empty to auto-detect from request (works if accessed directly, not via OAuth)
PUBLIC_APP_URL=

# ==================== INVENTORY BUSINESS RULES ====================

REORDER_SAFETY_DAYS=7
DEFAULT_SUPPLY_DAYS=45

# Reorder Priority Thresholds (in days)
# Note: inventory_alert_threshold from Square takes priority over days calculation

# Out of stock
REORDER_PRIORITY_URGENT_DAYS=0

# Less than 7 days
REORDER_PRIORITY_HIGH_DAYS=7

# Less than 14 days
REORDER_PRIORITY_MEDIUM_DAYS=14

# Less than 30 days
REORDER_PRIORITY_LOW_DAYS=30

# ==================== SYNC INTERVALS (in hours) ====================

# Configure how often each type of sync should run
SYNC_CATALOG_INTERVAL_HOURS=3
SYNC_LOCATIONS_INTERVAL_HOURS=3
SYNC_SALES_91D_INTERVAL_HOURS=3
SYNC_SALES_182D_INTERVAL_HOURS=24
SYNC_SALES_365D_INTERVAL_HOURS=168
SYNC_INVENTORY_INTERVAL_HOURS=3
SYNC_VENDORS_INTERVAL_HOURS=24

# ==================== CRON SCHEDULES ====================

# Format: minute hour day-of-month month day-of-week
# Examples:
#   '0 * * * *'     = Every hour
#   '*/30 * * * *'  = Every 30 minutes
#   '0 */2 * * *'   = Every 2 hours
#   '0 0 * * *'     = Daily at midnight
#   '0 2 * * 0'     = Every Sunday at 2:00 AM

# Google Merchant Center Sync
# Pushes product catalog updates to GMC via Content API
# Default: daily at 11:00 PM
# Leave unset to disable scheduled GMC sync (feed files are always available)
GMC_SYNC_CRON_SCHEDULE=0 23 * * *

# Automated Sync (catalog, inventory, velocity)
# Default: every hour at minute 0
SYNC_CRON_SCHEDULE=0 * * * *

# Automated Database Backup
# Default: every Sunday at 2:00 AM
# Note: Requires EMAIL_ENABLED=true to receive backups via email
BACKUP_CRON_SCHEDULE=0 2 * * 0

# Cycle Count (daily inventory counts)
# Default: every day at 1:00 AM
CYCLE_COUNT_CRON=0 1 * * *

# Expiry Discount (auto-apply discounts to expiring items)
# Default: every day at 6:00 AM
EXPIRY_DISCOUNT_CRON=0 6 * * *

# ==================== LOGGING ====================

# Options: debug, info, warn, error
# Note: Log rotation is configured in utils/logger.js (20MB max, 14 days retention)
LOG_LEVEL=info

# ==================== EMAIL NOTIFICATIONS ====================

# Set to 'true' to enable email alerts
EMAIL_ENABLED=false

# Options: gmail, outlook, or custom SMTP
EMAIL_SERVICE=gmail

# Your email address
EMAIL_USER=your-email@gmail.com

# Gmail app password (not regular password)
EMAIL_PASSWORD=your-app-password

# Where to send alerts
EMAIL_TO=alerts@yourdomain.com

# From address (optional)
EMAIL_FROM=noreply@yourdomain.com

# Minimum minutes between error emails
EMAIL_THROTTLE_MINUTES=5

# ==================== AWS S3 (Product Images) ====================

AWS_S3_BUCKET=items-images-production
AWS_S3_REGION=us-west-2

# ==================== CYCLE COUNT ====================

# Target number of items to count per day
DAILY_COUNT_TARGET=30

# Send daily count assignment emails
CYCLE_COUNT_EMAIL_ENABLED=true

# Send completion report emails
CYCLE_COUNT_REPORT_EMAIL=true

# Optional: Additional email for cycle count reports (e.g., staff@yourdomain.com)
ADDITIONAL_CYCLE_COUNT_REPORT_EMAIL=

# ==================== GOOGLE OAUTH ====================

# For Google Sheets integration
# Get these from: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID=your_google_client_id_here
GOOGLE_CLIENT_SECRET=your_google_client_secret_here

# GOOGLE_REDIRECT_URI - REQUIRED for Google OAuth
# This MUST exactly match one of the "Authorized redirect URIs" in Google Cloud Console
# IMPORTANT: Never use a private IP address (192.168.x.x, 10.x.x.x, 172.16-31.x.x)
# For local development:
GOOGLE_REDIRECT_URI=http://localhost:5001/api/google/callback
# For production, use your public domain:
# GOOGLE_REDIRECT_URI=https://yourdomain.com/api/google/callback
